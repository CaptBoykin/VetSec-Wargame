### From Exploitation: The Art of Hacking, pg 91-92 ###
#include <stdio.h>
#include <stdlib.h>

void usage(char *program_name, char *filename) {
	printf("Usage: %s <data to add to %s>\n", program_name, filename);
	exit(0);
}

int main(int argc, char *argv[]) {
	int userID, filedescriptor;
	char *buffer, *datafile;

	buffer = (char *) malloc(100);
	datafile = (char *) malloc(20);
	strcpy(datafile, "/var/notes");
	
	if(argc < 2)					// If there aren't enough command-line arguments,
		usage(argv[0], datafile);	// Display usage message and exit

	strcpy(buffer, argv[1]);	// Copy into buffer

	// Opening the file
	fd = open(datafile, O_WRONLY|O_CREAT|O_APPEND, S_IRUSR|S_IWUSR);
	if(fd == -1){
		printf("Error in main while opening file");	
		exit(0);
	}

	userID = getuid();	// Get the real user ID.

	// Writing the data
	if(write(fd, buffer, strlen(buffer)) == -1){		// Write note.
		printf("Error while writing buffer to file");
		exit(0);
	}

	//Closing file
	if(close(fd) == -1){
		printf("Error while closing file)");
		exit(0);
	}
	
	printf("Note has been saved.\n");
	free(buffer);
	free(datafile);
}

